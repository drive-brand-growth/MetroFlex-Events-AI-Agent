# Render.com Blueprint - MetroFlex AI Agent
# Infrastructure as Code deployment configuration

services:
  # MetroFlex AI Agent - Flask/OpenAI chatbot
  - type: web
    name: metroflex-ai-agent
    runtime: python
    region: oregon
    plan: free  # Change to 'starter' for $7/mo always-on
    branch: main  # Deploy from main branch (or your feature branch)

    # Build configuration
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt

    # Start configuration
    startCommand: cd AI_Agent && gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120 --worker-class gthread --log-level info

    # Health monitoring
    healthCheckPath: /health

    # Auto-deploy on git push
    autoDeploy: true

    # Environment variables (REQUIRED)
    envVars:
      - key: FLASK_ENV
        value: production

      - key: PORT
        value: 10000

      # IMPORTANT: Set this in Render Dashboard (not here for security)
      - key: OPENAI_API_KEY
        sync: false  # This must be set manually in Render Dashboard

      - key: PYTHON_VERSION
        value: 3.11.0
